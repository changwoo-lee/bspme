<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="bspme">
<title>Ozone exposure and health data analysis â€¢ bspme</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Ozone exposure and health data analysis">
<meta property="og:description" content="bspme">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">bspme</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Ozone-exposure-and-health-data-analysis.html">Ozone exposure and health data analysis</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/changwoo-lee/bspme" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Ozone exposure and health data analysis</h1>
            
      
      
      <div class="d-none name"><code>Ozone-exposure-and-health-data-analysis.Rmd</code></div>
    </div>

    
    
<p>This is a vignette for the <code>bspme</code> package based on ozone
exposure data of midwest US, 1987 and simulated health dataset.</p>
<p>First load the package and data:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://changwoo-lee.github.io/bspme/">bspme</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/dnychka/fieldsRPackage" class="external-link">fields</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ozone</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">)</span></span></code></pre></div>
<p>The ozone data are collected daily at 67 monitoring sites in midwest
US during 89 days. We focus on ozone exposure on a specific date
06/18/1987 (date id = 16). We also consider simulated health dataset,
with <span class="math inline">\(n=3000\)</span> subject locations and
continuous health responses.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ozone16</span> <span class="op">=</span> <span class="va">ozone</span><span class="op">[</span><span class="va">ozone</span><span class="op">$</span><span class="va">date_id</span><span class="op">==</span><span class="fl">16</span>,<span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lon</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lat</span><span class="op">)</span>,</span>
<span>           <span class="va">ozone16</span><span class="op">$</span><span class="va">ozone_ppb</span>, main <span class="op">=</span> <span class="st">"67 ozone monitoring sites"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/fields/man/US.html" class="external-link">US</a></span><span class="op">(</span>add<span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span>, pch <span class="op">=</span> <span class="fl">19</span>, cex <span class="op">=</span> <span class="fl">0.5</span>, col <span class="op">=</span> <span class="st">"grey"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Longitude"</span>, ylab <span class="op">=</span> <span class="st">"Latitude"</span>, main <span class="op">=</span> <span class="st">"3000 simulated health subject locations"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/fields/man/US.html" class="external-link">US</a></span><span class="op">(</span>add <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/ozone_eda-1.png" alt="plot of chunk ozone_eda" width="100%"><p class="caption">
plot of chunk ozone_eda
</p>
</div>
<div class="section level3">
<h3 id="obtain-posterior-predictive-distribution-at-health-subject-locations">Obtain posterior predictive distribution at health subject
locations<a class="anchor" aria-label="anchor" href="#obtain-posterior-predictive-distribution-at-health-subject-locations"></a>
</h3>
<p>In this example, we will use Gaussian process to obtain a predictive
distribution of <span class="math inline">\((X_1,\dots,X_n)\)</span>,
the ozone exposure at the health subject locations. The posterior
predictive distribution is n-dimensional multivariate normal <span class="math inline">\(N(\mu_X, Q_X^{-1})\)</span>, which will be used as
a prior in health model to incorporate measurement error information of
ozone exposure. Specifically, we will use the exponential covariance
kernel with fixed range 300 (in miles) and standard deviation 15 (in
ppb).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># distance calculation</span></span>
<span><span class="va">Dxx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/rdist.earth.html" class="external-link">rdist.earth</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lon</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Dyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/rdist.earth.html" class="external-link">rdist.earth</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">Dxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/rdist.earth.html" class="external-link">rdist.earth</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lon</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lat</span><span class="op">)</span>,</span>
<span>                  <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># kernel matrices</span></span>
<span><span class="va">Kxx</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/Exponential.html" class="external-link">Exponential</a></span><span class="op">(</span><span class="va">Dxx</span>, range <span class="op">=</span> <span class="fl">300</span>, phi<span class="op">=</span><span class="fl">15</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Kyy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/Exponential.html" class="external-link">Exponential</a></span><span class="op">(</span><span class="va">Dyy</span>, range <span class="op">=</span> <span class="fl">300</span>, phi<span class="op">=</span><span class="fl">15</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Kxy</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/fields/man/Exponential.html" class="external-link">Exponential</a></span><span class="op">(</span><span class="va">Dxy</span>, range <span class="op">=</span> <span class="fl">300</span>, phi<span class="op">=</span><span class="fl">15</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># posterior predictive mean and covariance</span></span>
<span><span class="va">X_mean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Kxy</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Kxx</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">ozone_ppb</span><span class="op">)</span></span>
<span><span class="va">X_cov</span> <span class="op">=</span> <span class="va">Kyy</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">Kxy</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">Kxx</span>, <span class="va">Kxy</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># visualization of posterior predictive distribution. Black triangle is monitoring station locations.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span><span class="op">)</span>,</span>
<span>           <span class="va">X_mean</span>, main <span class="op">=</span> <span class="st">"health subjects, mean of exposure"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/fields/man/US.html" class="external-link">US</a></span><span class="op">(</span>add<span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lon</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lat</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span><span class="op">)</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/diag.html" class="external-link">diag</a></span><span class="op">(</span><span class="va">X_cov</span><span class="op">)</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"health subjects, sd of exposure"</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/pkg/fields/man/US.html" class="external-link">US</a></span><span class="op">(</span>add<span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lon</span>, <span class="va">ozone16</span><span class="op">$</span><span class="va">coords_lat</span><span class="op">)</span>, pch <span class="op">=</span> <span class="fl">17</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/ozone_eda3-1.png" alt="plot of chunk ozone_eda3" width="100%"><p class="caption">
plot of chunk ozone_eda3
</p>
</div>
<p>The covariance of <span class="math inline">\((X_1,\dots,X_n)\)</span> contains all spatial
dependency information up to a second order, but its inverse <span class="math inline">\(Q_X\)</span> become a dense matrix. When it comes
to fitting the Bayesian linear model with measurement error, the naive
implementation with n-dimensional multivariate normal prior <span class="math inline">\(N(\mu_X, Q_X^{-1})\)</span> takes cubic time
complexity of posterior inference for each MCMC iteration, which becomes
infeasible to run when <span class="math inline">\(n\)</span> is large
such as tens of thousands.</p>
</div>
<div class="section level3">
<h3 id="run-vecchia-approximation-to-get-sparse-precision-matrix">Run Vecchia approximation to get sparse precision matrix<a class="anchor" aria-label="anchor" href="#run-vecchia-approximation-to-get-sparse-precision-matrix"></a>
</h3>
<p>We propose to use Vecchia approximation to get a new multivariate
normal prior of <span class="math inline">\((X_1,\dots,X_n)\)</span>
with sparse precision matrix, which is crucial for scalable
implementation of health model with measurement error, but also at the
same time it aims to best preserve the spatial dependency information in
the original covariance matrix.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#Run the Vecchia approximation to get the sparse precision matrix.</span></span>
<span></span>
<span><span class="co"># Vecchia approximation</span></span>
<span><span class="va">run_vecchia</span> <span class="op">=</span> <span class="fu"><a href="../reference/vecchia_cov.html">vecchia_cov</a></span><span class="op">(</span><span class="va">X_cov</span>, coords <span class="op">=</span> <span class="fu"><a href="https://www.math.uzh.ch/pages/spam/reference/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lon</span>, <span class="va">health_sim</span><span class="op">$</span><span class="va">coords_y_lat</span><span class="op">)</span>,</span>
<span>            n.neighbors <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Q_sparse</span> <span class="op">=</span> <span class="va">run_vecchia</span><span class="op">$</span><span class="va">Q</span></span>
<span><span class="va">run_vecchia</span><span class="op">$</span><span class="va">cputime</span></span>
<span><span class="co">#&gt; Time difference of 0.796325 secs</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fit-bspme-with-sparse-precision-matrix">Fit bspme with sparse precision matrix<a class="anchor" aria-label="anchor" href="#fit-bspme-with-sparse-precision-matrix"></a>
</h3>
<p>We can now fit the main function of bspme package with sparse
precision matrix.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit the model</span></span>
<span><span class="va">fit_me</span> <span class="op">=</span> <span class="fu">blinreg_me</span><span class="op">(</span>Y <span class="op">=</span> <span class="va">health_sim</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>              X_mean <span class="op">=</span> <span class="va">X_mean</span>,</span>
<span>              X_prec <span class="op">=</span> <span class="va">Q_sparse</span>, <span class="co"># sparse precision matrix</span></span>
<span>              Z <span class="op">=</span> <span class="va">health_sim</span><span class="op">$</span><span class="va">Z</span>,</span>
<span>              nburn <span class="op">=</span> <span class="fl">100</span>,</span>
<span>              nsave <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>              nthin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_me</span><span class="op">$</span><span class="va">cputime</span></span>
<span><span class="co">#&gt; Time difference of 6.17423 secs</span></span></code></pre></div>
<p>It took less than 10 seconds to (1) run Vecchia approximation and (2)
run the MCMC algorithm with total 1100 iterations.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_me</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Iterations = 1:1000</span></span>
<span><span class="co">#&gt; Thinning interval = 1 </span></span>
<span><span class="co">#&gt; Number of chains = 1 </span></span>
<span><span class="co">#&gt; Sample size per chain = 1000 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1. Empirical mean and standard deviation for each variable,</span></span>
<span><span class="co">#&gt;    plus standard error of the mean:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                 Mean       SD  Naive SE Time-series SE</span></span>
<span><span class="co">#&gt; (Intercept) 100.0234 0.624015 0.0197331      0.0259492</span></span>
<span><span class="co">#&gt; exposure.1   -0.5021 0.007004 0.0002215      0.0003135</span></span>
<span><span class="co">#&gt; covariate.1   4.3374 0.337301 0.0106664      0.0126324</span></span>
<span><span class="co">#&gt; sigma2_Y     24.7826 0.712924 0.0225446      0.0280662</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 2. Quantiles for each variable:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                2.5%     25%      50%      75%    97.5%</span></span>
<span><span class="co">#&gt; (Intercept) 98.8360 99.6014 100.0057 100.4462 101.2774</span></span>
<span><span class="co">#&gt; exposure.1  -0.5163 -0.5066  -0.5021  -0.4974  -0.4882</span></span>
<span><span class="co">#&gt; covariate.1  3.6657  4.1060   4.3402   4.5681   4.9898</span></span>
<span><span class="co">#&gt; sigma2_Y    23.3910 24.3080  24.7964  25.2340  26.1523</span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu">mcmc_trace</span><span class="op">(</span><span class="va">fit_me</span><span class="op">$</span><span class="va">posterior</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/unnamed-chunk-3-1.png" alt=""><p class="caption">plot of chunk unnamed-chunk-3</p>
</div>
</div>
<div class="section level3">
<h3 id="fit-bspme-without-sparse-precision-matrix">Fit bspme without sparse precision matrix<a class="anchor" aria-label="anchor" href="#fit-bspme-without-sparse-precision-matrix"></a>
</h3>
<p>As mentioned before, if precision matrix is dense, the posterior
computation becomes infeasible when <span class="math inline">\(n\)</span> becomes large, such as tens of
thousands. See the following example when <span class="math inline">\(n=3000\)</span>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># fit the model, without vecchia approximation</span></span>
<span><span class="co"># I will only run 11 iteration for illustration purpose</span></span>
<span><span class="va">Q_dense</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/solve-methods.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">X_cov</span><span class="op">)</span> <span class="co"># inverting 3000 x 3000 matrix, takes some time</span></span>
<span><span class="co"># run</span></span>
<span><span class="va">fit_me_dense</span> <span class="op">=</span> <span class="fu">blinreg_me</span><span class="op">(</span>Y <span class="op">=</span> <span class="va">health_sim</span><span class="op">$</span><span class="va">Y</span>,</span>
<span>                X_mean <span class="op">=</span> <span class="va">X_mean</span>,</span>
<span>                X_prec <span class="op">=</span> <span class="va">Q_dense</span>, <span class="co"># dense precision</span></span>
<span>                Z <span class="op">=</span> <span class="va">health_sim</span><span class="op">$</span><span class="va">Z</span>,</span>
<span>                nburn <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                nsave <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                nthin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_me_dense</span><span class="op">$</span><span class="va">cputime</span></span>
<span><span class="co">#&gt; Time difference of 58.06338 secs</span></span></code></pre></div>
<p>With even only 11 MCMC iterations, It took about 1 mins to run the
MCMC algorithm. If number of health subject locations is tens of
thousands, the naive algorithm using dense precision matrix becomes
infeasible, and Vecchia approximation becomes necesssary to carry out
the inference.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Changwoo Lee, Eun Sug Park.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
