[{"path":"https://changwoo-lee.github.io/bspme/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2024 bspme authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://changwoo-lee.github.io/bspme/articles/no2-exposure-and-health-data-analysis.html","id":"obtain-posterior-predictive-distribution-at-health-subject-locations","dir":"Articles","previous_headings":"","what":"Obtain posterior predictive distribution at health subject locations","title":"NO2 exposure and health data analysis","text":"example, use Gaussian process obtain predictive distribution \\((X_1,\\dots,X_n)\\), log(NO2) exposure health subject locations. posterior predictive distribution n-dimensional multivariate normal \\(N(\\mu_X, Q_X^{-1})\\), used prior health model incorporate measurement error information ozone exposure. Specifically, use exponential covariance kernel fixed range 5 (miles) standard deviation 1 (ppbv). plot chunk eda2 covariance \\((X_1,\\dots,X_n)\\) contains spatial dependency information second order, inverse \\(Q_X\\) become dense matrix. comes fitting Bayesian linear model measurement error, naive implementation n-dimensional multivariate normal prior \\(N(\\mu_X, Q_X^{-1})\\) takes cubic time complexity posterior inference MCMC iteration, becomes infeasible run \\(n\\) large tens thousands.","code":"coords_monitor = cbind(data_jan10$lon, data_jan10$lat) coords_health = cbind(health_sim$lon, health_sim$lat) a = 5; sigma = 1; # assume known # distance calculation distmat_xx <- rdist.earth(coords_monitor) distmat_xy <- rdist.earth(coords_monitor, coords_health) distmat_yy <- rdist.earth(coords_health)  # GP covariance matrices Sigmaxx = fields::Matern(distmat_xx, smoothness = 0.5, range = a, phi = sigma^2) Sigmaxy = fields::Matern(distmat_xy, smoothness = 0.5, range = a, phi = sigma^2) Sigmayy = fields::Matern(distmat_yy, smoothness = 0.5, range = a, phi = sigma^2)  # posterior predictive mean and covariance X_mean <- t(Sigmaxy) %*% solve(Sigmaxx, data_jan10$lnNO2) X_cov <- Sigmayy - t(Sigmaxy) %*% solve(Sigmaxx,Sigmaxy) # n_y by n_y  # visualization of posterior predictive distribution. Black triangle is monitoring station locations. par(mfrow = c(1,2)) quilt.plot(cbind(health_sim$lon, health_sim$lat),           X_mean, main = \"posterior predictive mean of exposure at health data locations\",           xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T) # posterior predictive sd of exposure at health data quilt.plot(cbind(health_sim$lon, health_sim$lat),           sqrt(diag(X_cov)), main = \"posterior predictive sd of exposure at health data locations\",           xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)"},{"path":"https://changwoo-lee.github.io/bspme/articles/no2-exposure-and-health-data-analysis.html","id":"run-vecchia-approximation-to-get-sparse-precision-matrix","dir":"Articles","previous_headings":"","what":"Run Vecchia approximation to get sparse precision matrix","title":"NO2 exposure and health data analysis","text":"propose use Vecchia approximation get new multivariate normal prior \\((X_1,\\dots,X_n)\\) sparse precision matrix, crucial scalable implementation health model measurement error, also time aims best preserve spatial dependency information original covariance matrix.","code":"#Run the Vecchia approximation to get the sparse precision matrix.  # Vecchia approximation run_vecchia = vecchia_cov(X_cov, coords = cbind(health_sim$lon, health_sim$lat),             n.neighbors = 10) Q_sparse = run_vecchia$Q run_vecchia$cputime #> Time difference of 0.5999758 secs"},{"path":"https://changwoo-lee.github.io/bspme/articles/no2-exposure-and-health-data-analysis.html","id":"fit-bspme-with-sparse-precision-matrix","dir":"Articles","previous_headings":"","what":"Fit bspme with sparse precision matrix","title":"NO2 exposure and health data analysis","text":"can now fit main function bspme package sparse precision matrix. took less 10 seconds (1) run Vecchia approximation (2) run MCMC algorithm total 1100 iterations. plot chunk unnamed-chunk-3","code":"# fit the model fit_me = blm_me(Y = health_sim$Y,               X_mean = X_mean,               X_prec = Q_sparse, # sparse precision matrix               Z = health_sim$Z,               nburn = 100,               nsave = 1000,               nthin = 1) fit_me$cputime #> Time difference of 7.23181 secs summary(fit_me$posterior) #>  #> Iterations = 1:1000 #> Thinning interval = 1  #> Number of chains = 1  #> Sample size per chain = 1000  #>  #> 1. Empirical mean and standard deviation for each variable, #>    plus standard error of the mean: #>  #>                Mean      SD Naive SE Time-series SE #> (Intercept)  0.7646 0.07789 0.002463       0.010519 #> exposure.1  -1.9594 0.05087 0.001609       0.007164 #> covariate.1  2.9536 0.03997 0.001264       0.003023 #> sigma2_Y     0.9759 0.15318 0.004844       0.033582 #>  #> 2. Quantiles for each variable: #>  #>                2.5%     25%     50%     75%   97.5% #> (Intercept)  0.6082  0.7191  0.7665  0.8129  0.9187 #> exposure.1  -2.0572 -1.9954 -1.9582 -1.9243 -1.8647 #> covariate.1  2.8712  2.9281  2.9534  2.9815  3.0285 #> sigma2_Y     0.6451  0.8785  0.9800  1.0645  1.3046 bayesplot::mcmc_trace(fit_me$posterior)"},{"path":"https://changwoo-lee.github.io/bspme/articles/no2-exposure-and-health-data-analysis.html","id":"fit-bspme-without-sparse-precision-matrix","dir":"Articles","previous_headings":"","what":"Fit bspme without sparse precision matrix","title":"NO2 exposure and health data analysis","text":"mentioned , precision matrix dense, posterior computation becomes infeasible \\(n\\) becomes large, tens thousands. See following example \\(n=2000\\). even 11 MCMC iterations, took 15 seconds run MCMC algorithm. number iterations (1100), take 1500 seconds, .e. 25 minutes run MCMC algorithm. gap becomes much larger number health subject locations grows, tens thousands. , naive algorithm using dense precision matrix becomes infeasible, can carry inference using Vecchia approximation. quality Vecchia approximation depends size nearest neighbors, controlled argument n.neighbors vecchia_cov function. larger n.neighbors, better approximation. simulaton study Lee et al. (2024), Vecchia approximation small n.neighbors can provide scalable inference method results (e.g. RMSE, empirical coverage) close results based dense precision matrix fully Bayesian analysis.","code":"# fit the model, without vecchia approximation # I will only run 11 iteration for illustration purpose Q_dense = solve(X_cov) # inverting 3000 x 3000 matrix, takes some time # run fit_me_dense = blm_me(Y = health_sim$Y,                 X_mean = X_mean,                 X_prec = Q_dense, # dense precision                 Z = health_sim$Z,                 nburn = 1,                 nsave = 10,                 nthin = 1) fit_me_dense$cputime #> Time difference of 16.98819 secs"},{"path":"https://changwoo-lee.github.io/bspme/articles/no2-exposure-and-health-data-analysis.html","id":"references","dir":"Articles","previous_headings":"","what":"References","title":"NO2 exposure and health data analysis","text":"Lee, C. J., Symanski, E., Rammah, ., Kang, D. H., Hopke, P. K., & Park, E. S. (2024). scalable two-stage Bayesian approach accounting exposure measurement error environmental epidemiology. arXiv preprint arXiv:2401.00634.","code":""},{"path":"https://changwoo-lee.github.io/bspme/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Changwoo Lee. Author, maintainer. Eun Sug Park. Author.","code":""},{"path":"https://changwoo-lee.github.io/bspme/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Lee, J. C, Symanski E, Rammah , Kang DH, Hopke PK, Park ES (2023). “scalable two-stage Bayesian approach accounting exposure measurement error environmental epidemiology.” arXiv preprint. tobeadded.","code":"@Article{,   title = {A scalable two-stage Bayesian approach accounting for exposure measurement error in environmental epidemiology.},   year = {2023},   author = {{Lee} and Changwoo J. and Elaine Symanski and Amal Rammah and Dong Hun Kang and Philip K. Hopke and Eun Sug Park},   url = {tobeadded},   journal = {arXiv preprint}, }"},{"path":"https://changwoo-lee.github.io/bspme/index.html","id":"bspme","dir":"","previous_headings":"","what":"Bayesian Spatial Measurement Error Models","title":"Bayesian Spatial Measurement Error Models","text":"Go package website: [link] (NOTE: NOW UNPUBLISHED) See vignette ozone exposure data: [link] (NOTE: SEE “INSTALLATION” SECTION INSTEAD) bspme R package provides set functions Bayesian spatial exposure measurement error models, Bayesian linear generalized linear models presence spatially correlated measurement error covariate(s). details, please see following paper: Lee, C. J., Symanski, E., Rammah, ., Kang, D. H., Hopke, P. K., & Park, E. S. (2024). scalable two-stage Bayesian approach accounting exposure measurement error environmental epidemiology. arXiv preprint arXiv:2401.00634. https://arxiv.org/abs/2401.00634 bspme package provides fast, scalable inference tools Bayesian linear generalized linear models spatial exposure measurement error. models typically arises two-stage Bayesian analysis environmental exposures health outcomes, predictions covariate interest (exposure) first-stage model uncertainty information used second-stage regression model. spatial exposure measurement error represented multivariate normal prior distribution sparse precision matrix Q. Naive, non-sparse choices Q, sample precision matrix, make MCMC posterior inference algorithm infeasible run large number subjects n O(n3) computational cost associated n-dimensional MVN prior. sparse precision matrix Q obtained Vecchia approximation, bspme package offers fast, scalable algorithm conduct posterior inference large health datasets, number subjects n possibly reaching tens thousands.","code":""},{"path":"https://changwoo-lee.github.io/bspme/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"Bayesian Spatial Measurement Error Models","text":"can install development version bspme following code: browse see vignettes, run","code":"# install.packages(\"devtools\") # never share below token devtools::install_github(\"changwoo-lee/bspme\", auth_token = \"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\", build_vignettes = T, force= T) browseVignettes(\"bspme\")"},{"path":"https://changwoo-lee.github.io/bspme/index.html","id":"functionality","dir":"","previous_headings":"","what":"Functionality","title":"Bayesian Spatial Measurement Error Models","text":"see function description R environment, run following lines:","code":"?blm_me ?vecchia_cov"},{"path":[]},{"path":"https://changwoo-lee.github.io/bspme/index.html","id":"examples","dir":"","previous_headings":"","what":"Examples","title":"Bayesian Spatial Measurement Error Models","text":"Please see vignette “NO2 exposure simulated health data”.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/NO2_Jan2012.html","id":null,"dir":"Reference","previous_headings":"","what":"Daily average NO2 (nitrogen dioxide) measurements at Houston area — NO2_Jan2012","title":"Daily average NO2 (nitrogen dioxide) measurements at Houston area — NO2_Jan2012","text":"dataset ","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/NO2_Jan2012.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Daily average NO2 (nitrogen dioxide) measurements at Houston area — NO2_Jan2012","text":"","code":"data(NO2_Jan2012)"},{"path":"https://changwoo-lee.github.io/bspme/reference/NO2_Jan2012.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Daily average NO2 (nitrogen dioxide) measurements at Houston area — NO2_Jan2012","text":"data frame 5963 rows 6 variables: date POSIXct, date site_name character, monitoring station name lon numeric, longitude monitoring station lat numeric, latitude monitoring station lnNO2 numeric, natural logarithm daily average NO2 concentrations, parts per billion volume (ppbv)","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":null,"dir":"Reference","previous_headings":"","what":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"function fits Bayesian generalized linear model presence spatial exposure measurement error covariate(s) \\(X\\), represented multivariate normal prior. One important features function allows sparse matrix input prior precision matrix \\(X\\) scalable computation. version 1.0.0, Bayesian logistic regression model supported among GLMs, function bglm_me() runs Gibbs sampler carry posterior inference using Polya-Gamma augmentation (Polson et al., 2013). See \"Details\" section model description, Lee et al. (2024) application example environmental epidemiology.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"","code":"bglm_me(   Y,   X_mean,   X_prec,   Z,   family = binomial(link = \"logit\"),   nburn = 1000,   nsave = 1000,   nthin = 1,   prior = NULL,   saveX = FALSE )"},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"Y vector<int>, n 1 binary response vector. X_mean matrix<num>, n 1 prior mean matrix \\(\\mu_X\\). q multiple exposures subject measurement error, can length q list n 1 matrices. X_prec matrix<num>, n 1 prior precision matrix \\(Q_X\\), allows sparse format Matrix package. q multiple exposures subject measurement error, can length q list n n matrices. Z matrix<num>, n p covariates subject measurement error. family class family, description error distribution link function used model. Currently supports binomial(link = \"logit\"). nburn integer, burn-iteration, default 1000. nsave integer, number posterior samples, default 1000. Total number MCMC iteration nburn + nsave * nthin. nthin integer, thin-rate, default 1. prior list, list prior parameters regression model. Default list(var_beta = 100). saveX logical, default FALSE, whether save posterior samples X (exposure).","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"List following: posterior nsave (q+p) matrix posterior samples \\(\\beta_x\\) \\(\\beta_z\\) coda::mcmc object. time Time taken running MCMC (seconds) X_save (saveX = TRUE) Posterior samples X","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"Denote \\(Y_i\\) binary response, \\(X_i\\) \\(q\\times 1\\) covariate subject spatial exposure measurement error, \\(Z_i\\) \\(p\\times 1\\) covariate without measurement error. Consider logistic regression model, independently \\(=1,\\dots,n,\\) $$\\log(Pr(Y_i = 1)/Pr(Y_i = 0)) = \\beta_0 + X_i^\\top \\beta_X +  Z_i^\\top \\beta_Z,$$ spatial exposure measurement error \\(X_i\\) \\(=1,\\dots,n\\) incorporated model multivariate normal prior. example \\(q=1\\), \\(n-\\)dimensional multivariate normal prior \\(X = (X_1,\\dots,X_n)^\\top\\), $$(X_1,\\dots,X_n)\\sim N_n(\\mu_X, Q_X^{-1}).$$ importantly, allows sparse matrix input prior precision matrix \\(Q_X\\) scalable computation, obtained Vecchia approximation. consider normal priors regression coefficients, $$\\beta_0 \\sim N(0, V_\\beta), \\quad \\beta_{X,j} \\stackrel{iid}{\\sim} N(0, V_\\beta), \\quad \\beta_{Z,k} \\stackrel{iid}{\\sim} N(0, V_\\beta)$$ var_beta corresponds \\(V_\\beta\\).","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"Polson, N. G., Scott, J. G., & Windle, J. (2013). Bayesian inference logistic models using Pólya–Gamma latent variables. Journal American statistical Association, 108(504), 1339-1349. Lee, C. J., Symanski, E., Rammah, ., Kang, D. H., Hopke, P. K., & Park, E. S. (2024). scalable two-stage Bayesian approach accounting exposure measurement error environmental epidemiology. arXiv preprint arXiv:2401.00634.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/bglm_me.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bayesian generalized linear models with spatial exposure measurement error. — bglm_me","text":"","code":"if (FALSE) { library(bspme) data(NO2_Jan2012) data(health_sim) library(fields) library(maps) # Obtain the predicted exposure mean and covariance at health subject locations based on Jan 10, 2012 data # using Gaussian process prior with mean zero and exponential covariance kernel # with fixed range 5 (in miles) and stdev 0.5 (in ppbv)  # exposure data data_jan10 = NO2_Jan2012[NO2_Jan2012$date == as.POSIXct(\"2012-01-10\"),] coords_monitor = cbind(data_jan10$lon, data_jan10$lat)  # health data coords_health = cbind(health_sim$lon, health_sim$lat)  distmat_xx <- rdist.earth(coords_monitor) distmat_xy <- rdist.earth(coords_monitor, coords_health) distmat_yy <- rdist.earth(coords_health)  a = 5; sigma = 1; # assume known  Sigmaxx = fields::Matern(distmat_xx, smoothness = 0.5, range = a, phi = sigma^2) Sigmaxy = fields::Matern(distmat_xy, smoothness = 0.5, range = a, phi = sigma^2) Sigmayy = fields::Matern(distmat_yy, smoothness = 0.5, range = a, phi = sigma^2)  # posterior predictive mean and covariance of exposure at health data X_mean <- t(Sigmaxy) %*% solve(Sigmaxx, data_jan10$lnNO2) X_cov <- Sigmayy - t(Sigmaxy) %*% solve(Sigmaxx,Sigmaxy) # n_y by n_y  # visualize # monitoring station exposure data quilt.plot(cbind(data_jan10$lon, data_jan10$lat),            data_jan10$lnNO2, main = \"NO2 exposures (in log) at 21 stations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)  # posterior predictive mean of exposure at health data quilt.plot(cbind(health_sim$lon, health_sim$lat),            X_mean, main = \"posterior predictive mean of exposure at health data locations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)  # posterior predictive sd of exposure at health data quilt.plot(cbind(health_sim$lon, health_sim$lat),            sqrt(diag(X_cov)), main = \"posterior predictive sd of exposure at health data locations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)   # vecchia approximation run_vecchia = vecchia_cov(X_cov, coords = cbind(health_sim$lon, health_sim$lat),                           n.neighbors = 10) Q_sparse = run_vecchia$Q run_vecchia$cputime  # fit the model, continuous data fit = bglm_me(Y = health_sim$Ybinary,                 X_mean = X_mean,                 X_prec = Q_sparse, # sparse precision matrix                 Z = health_sim$Z,                 family = binomial(link = \"logit\"),                 nburn = 1000,                 nsave = 1000,                 nthin = 5) fit$cputime summary(fit$posterior) library(bayesplot) bayesplot::mcmc_trace(fit$posterior) }"},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":null,"dir":"Reference","previous_headings":"","what":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"function fits Bayesian linear regression model presence spatial exposure measurement error covariate(s) \\(X\\), represented multivariate normal prior. One important features function allows sparse matrix input prior precision matrix \\(X\\) scalable computation. Function blm_me() runs Gibbs sampler carry posterior inference; see \"Details\" section model description, Lee et al. (2024) application example environmental epidemiology.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"","code":"blm_me(   Y,   X_mean,   X_prec,   Z,   nburn = 1000,   nsave = 1000,   nthin = 1,   prior = NULL,   saveX = FALSE )"},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"Y vector<int>, n 1 continuous response vector. X_mean matrix<num>, n 1 prior mean matrix \\(\\mu_X\\). q multiple exposures subject measurement error, can length q list n 1 matrices. X_prec matrix<num>, n 1 prior precision matrix \\(Q_X\\), allows sparse format Matrix package. q multiple exposures subject measurement error, can length q list n n matrices. Z matrix<num>, n p covariates subject measurement error. nburn integer, burn-iteration, default 1000. nsave integer, number posterior samples, default 1000. Total number MCMC iteration nburn + nsave * nthin. nthin integer, thin-rate, default 1. prior list, list prior parameters regression model. Default list(var_beta = 100, a_Y = 0.01, b_Y = 0.01). saveX logical, default FALSE, whether save posterior samples X (exposure).","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"list following: posterior nsave (q + p + 1) matrix posterior samples \\(\\beta_X\\), \\(\\beta_Z\\), \\(\\sigma_Y^2\\) coda::mcmc object. time Time taken running MCMC (seconds) X_save (saveX = TRUE) Posterior samples X","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"details","dir":"Reference","previous_headings":"","what":"Details","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"Denote \\(Y_i\\) binary response, \\(X_i\\) \\(q\\times 1\\) covariate subject spatial exposure measurement error, \\(Z_i\\) \\(p\\times 1\\) covariate without measurement error. Consider normal linear regression model, $$Y_i = \\beta_0 + X_i^\\top \\beta_X +  Z_i^\\top \\beta_Z + \\epsilon_i,\\quad  \\epsilon_i \\stackrel{iid}{\\sim} N(0, \\sigma^2_Y), \\quad =1,\\dots,n,$$ spatial exposure measurement error \\(X_i\\) \\(=1,\\dots,n\\) incorporated model multivariate normal prior. example \\(q=1\\), \\(n-\\)dimensional multivariate normal prior \\(X = (X_1,\\dots,X_n)^\\top\\), $$(X_1,\\dots,X_n)\\sim N_n(\\mu_X, Q_X^{-1}).$$ importantly, allows sparse matrix input prior precision matrix \\(Q_X\\) scalable computation, obtained Vecchia approximation. consider semiconjugate priors regression coefficients error variance, $$\\beta_0 \\sim N(0, V_\\beta), \\quad \\beta_{X,j} \\stackrel{iid}{\\sim} N(0, V_\\beta), \\quad \\beta_{Z,k} \\stackrel{iid}{\\sim} N(0, V_\\beta), \\quad \\sigma_Y^2 \\sim IG(a_Y, b_Y).$$ var_beta corresponds \\(V_\\beta\\) a_Y, b_Y corresponds hyperparameters \\(\\sigma^2_Y\\).","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"Lee, C. J., Symanski, E., Rammah, ., Kang, D. H., Hopke, P. K., & Park, E. S. (2024). scalable two-stage Bayesian approach accounting exposure measurement error environmental epidemiology. arXiv preprint arXiv:2401.00634.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/blm_me.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Bayesian linear regression models with spatial exposure measurement error. — blm_me","text":"","code":"if (FALSE) { library(bspme) data(NO2_Jan2012) data(health_sim) library(fields) library(maps) # Obtain the predicted exposure mean and covariance at health subject locations based on Jan 10, 2012 data # using Gaussian process prior with mean zero and exponential covariance kernel # with fixed range 5 (in miles) and stdev 0.5 (in ppbv)  # exposure data data_jan10 = NO2_Jan2012[NO2_Jan2012$date == as.POSIXct(\"2012-01-10\"),] coords_monitor = cbind(data_jan10$lon, data_jan10$lat)  # health data coords_health = cbind(health_sim$lon, health_sim$lat)  distmat_xx <- rdist.earth(coords_monitor) distmat_xy <- rdist.earth(coords_monitor, coords_health) distmat_yy <- rdist.earth(coords_health)  a = 5; sigma = 1; # assume known  Sigmaxx = fields::Matern(distmat_xx, smoothness = 0.5, range = a, phi = sigma^2) Sigmaxy = fields::Matern(distmat_xy, smoothness = 0.5, range = a, phi = sigma^2) Sigmayy = fields::Matern(distmat_yy, smoothness = 0.5, range = a, phi = sigma^2)  # posterior predictive mean and covariance of exposure at health data X_mean <- t(Sigmaxy) %*% solve(Sigmaxx, data_jan10$lnNO2) X_cov <- Sigmayy - t(Sigmaxy) %*% solve(Sigmaxx,Sigmaxy) # n_y by n_y  # visualize # monitoring station exposure data quilt.plot(cbind(data_jan10$lon, data_jan10$lat),            data_jan10$lnNO2, main = \"NO2 exposures (in log) at 21 stations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)  # posterior predictive mean of exposure at health data quilt.plot(cbind(health_sim$lon, health_sim$lat),            X_mean, main = \"posterior predictive mean of exposure at health data locations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)  # posterior predictive sd of exposure at health data quilt.plot(cbind(health_sim$lon, health_sim$lat),            sqrt(diag(X_cov)), main = \"posterior predictive sd of exposure at health data locations\",            xlab = \"longitude\", ylab= \"latitude\", xlim = c(-96.5, -94.5), ylim = c(29, 30.5)) maps::map(\"county\", \"Texas\", add = T)   # vecchia approximation run_vecchia = vecchia_cov(X_cov, coords = cbind(health_sim$lon, health_sim$lat),                           n.neighbors = 10) Q_sparse = run_vecchia$Q run_vecchia$cputime  # fit the model, continuous data fit = blm_me(Y = health_sim$Y,                 X_mean = X_mean,                 X_prec = Q_sparse, # sparse precision matrix                 Z = health_sim$Z,                 nburn = 1000,                 nsave = 1000,                 nthin = 5) fit$cputime summary(fit$posterior) library(bayesplot) bayesplot::mcmc_trace(fit$posterior) }"},{"path":"https://changwoo-lee.github.io/bspme/reference/bspme-package.html","id":null,"dir":"Reference","previous_headings":"","what":"bspme: Bayesian Spatial Measurement Error Models — bspme-package","title":"bspme: Bayesian Spatial Measurement Error Models — bspme-package","text":"Scalable methods fitting Bayesian linear generalized linear models presence spatial exposure measurement error, represented multivariate normal prior distribution. models typically arises two-stage Bayesian analysis environmental exposures health outcomes, predictions covariate interest (exposure) first-stage model uncertainty information used second-stage regression model. Related articles include Gryparis et al. (2009) (https://doi.org/10.1093/biostatistics/kxn033), Peng Bell (2010) (https://doi.org/10.1093/biostatistics/kxq017), Chang, Peng, Dominici (2011) (https://doi.org/10.1093/biostatistics/kxr002), Lee et al. (2024) (https://arxiv.org/abs/2401.00634).","code":""},{"path":[]},{"path":"https://changwoo-lee.github.io/bspme/reference/bspme-package.html","id":"author","dir":"Reference","previous_headings":"","what":"Author","title":"bspme: Bayesian Spatial Measurement Error Models — bspme-package","text":"Maintainer: Changwoo Lee c.lee@stat.tamu.edu Authors: Eun Sug Park","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/health_sim.html","id":null,"dir":"Reference","previous_headings":"","what":"Simulated health data — health_sim","title":"Simulated health data — health_sim","text":"Simulated health data based ln(NO2) concentration Jan 10, 2012. details, see health_sim.R.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/health_sim.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Simulated health data — health_sim","text":"","code":"data(health_sim)"},{"path":"https://changwoo-lee.github.io/bspme/reference/health_sim.html","id":"format","dir":"Reference","previous_headings":"","what":"Format","title":"Simulated health data — health_sim","text":"data frame n = 3000 rows 4 variables: Y n 1 matrix, numeric, simulated continuous health outcome Ybinary n 1 matrix, numeric, simulated binary health outcome lon n 1 matrix, numeric, simulated health subject longitude lat n 1 matrix, numeric, simulated health subject latitude Z n 1 matrix, numeric, covariate X_true n 1 matrix, numeric, true ozone exposure used simulation","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":null,"dir":"Reference","previous_headings":"","what":"Run Vecchia approximation given a covariance matrix — vecchia_cov","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"Given multivariate normal (MVN) distribution covariance matrix \\(\\Sigma\\), function finds sparse precision matrix (inverse covariance) \\(Q\\) based Vecchia approximation (Vecchia 1988, Katzfuss Guinness 2021), \\(N(\\mu, Q^{-1})\\) sparse MVN approximates original MVN \\(N(\\mu, \\Sigma)\\). algorithm based pseudocode 2 Finley et al. (2019).","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"","code":"vecchia_cov(Sigma, coords, n.neighbors, ord = NULL, KLdiv = FALSE)"},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"Sigma matrix<num>, n n covariance matrix coords matrix<num>, n 2 coordinate matrix nearest neighborhood search n.neighbors integer, number nearest neighbors (k) determine conditioning set Vecchia approximation ord vector<int>, length n vector, ordering data. NULL, ordering based first coordinate used. KLdiv logical, TRUE, return KL divergence \\(D_{KL}(p || \\tilde{p})\\) \\(p\\) multivariate normal original covariance matrix \\(\\tilde{p}\\) approximated multivariate normal sparse precision matrix.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"list following: Q n n sparse precision matrix Matrix format ord ordering used Vecchia approximation cputime time taken run Vecchia approximation KLdiv (KLdiv = TRUE) KL divergence \\(D_{KL}(p || \\tilde{p})\\) \\(p\\) multivariate normal original covariance matrix \\(\\tilde{p}\\) approximated multivariate normal sparse precision matrix.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":"references","dir":"Reference","previous_headings":"","what":"References","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"Vecchia, . V. (1988). Estimation model identification continuous spatial processes. Journal Royal Statistical Society Series B: Statistical Methodology, 50(2), 297-312. Katzfuss, M., & Guinness, J. (2021). General Framework Vecchia Approximations Gaussian Processes. Statistical Science, 36(1). Finley, . O., Datta, ., Cook, B. D., Morton, D. C., Andersen, H. E., & Banerjee, S. (2019). Efficient algorithms Bayesian nearest neighbor Gaussian processes. Journal Computational Graphical Statistics, 28(2), 401-414. Zhang, L., (2020), public Github repository https://github.com/LuZhangstat/NNGP_STAN.","code":""},{"path":"https://changwoo-lee.github.io/bspme/reference/vecchia_cov.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Run Vecchia approximation given a covariance matrix — vecchia_cov","text":"","code":"n = 1000 coords = cbind(runif(n), runif(n)) Sigma = fields::Exp.cov(coords, aRange = 1) fit5 = vecchia_cov(Sigma, coords, n.neighbors = 5, KLdiv = TRUE) fit5$KLdiv #> [1] 1109.855 fit10 = vecchia_cov(Sigma, coords, n.neighbors = 10, KLdiv = TRUE) fit10$KLdiv #> [1] 936.6073"}]
